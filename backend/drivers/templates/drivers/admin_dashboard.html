<!DOCTYPE html>
<html>
<head>
    <title>Admin Dashboard - Driver Management</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .header { background: #dc3545; color: white; padding: 20px; border-radius: 8px; margin-bottom: 20px; }
        .stats { display: flex; gap: 20px; margin-bottom: 20px; }
        .stat-card { background: #f8f9fa; padding: 20px; border-radius: 8px; flex: 1; text-align: center; }
        .drivers-table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        .drivers-table th, .drivers-table td { border: 1px solid #ddd; padding: 12px; text-align: left; }
        .drivers-table th { background: #f8f9fa; }
        .btn { padding: 8px 16px; margin: 2px; border: none; border-radius: 4px; cursor: pointer; }
        .btn-success { background: #28a745; color: white; }
        .btn-warning { background: #ffc107; color: black; }
        .btn-danger { background: #dc3545; color: white; }
        .status-pending { color: #ffc107; font-weight: bold; }
        .status-active { color: #28a745; font-weight: bold; }
        .status-suspended { color: #dc3545; font-weight: bold; }
        .bulk-actions { margin: 20px 0; padding: 15px; background: #f8f9fa; border-radius: 8px; }
    </style>
</head>
<body>
    <div class="header">
        <h1>Admin Dashboard - Driver Management</h1>
        <p>Kelola status driver dengan mudah</p>
    </div>

    <div class="stats">
        <div class="stat-card">
            <h3>{{ pending_count }}</h3>
            <p>Pending Approval</p>
        </div>
        <div class="stat-card">
            <h3>{{ active_count }}</h3>
            <p>Active Drivers</p>
        </div>
        <div class="stat-card">
            <h3>{{ suspended_count }}</h3>
            <p>Suspended Drivers</p>
        </div>
        <div class="stat-card">
            <h3>{{ total_count }}</h3>
            <p>Total Drivers</p>
        </div>
    </div>

    <div class="bulk-actions">
        <h4>Bulk Actions</h4>
        <button class="btn btn-success" onclick="bulkAction('accept')">Accept Selected</button>
        <button class="btn btn-success" onclick="bulkAction('activate')">Activate Selected</button>
        <button class="btn btn-danger" onclick="bulkAction('suspend')">Suspend Selected</button>
    </div>

    <table class="drivers-table">
        <thead>
            <tr>
                <th><input type="checkbox" id="selectAll"></th>
                <th>ID</th>
                <th>Nama</th>
                <th>Email</th>
                <th>No. SIM</th>
                <th>Status</th>
                <th>Tanggal Daftar</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for driver in drivers %}
            <tr>
                <td><input type="checkbox" class="driver-checkbox" value="{{ driver.id_driver }}"></td>
                <td>{{ driver.id_driver }}</td>
                <td>{{ driver.nama }}</td>
                <td>{{ driver.email }}</td>
                <td>{{ driver.no_sim }}</td>
                <td class="status-{{ driver.status }}">{{ driver.get_status_display }}</td>
                <td>{{ driver.wkt_daftar|date:"d M Y H:i" }}</td>
                <td>
                    {% if driver.status == 'pending' %}
                        <button class="btn btn-success" onclick="updateStatus({{ driver.id_driver }}, 'accept')">Accept</button>
                    {% endif %}
                    {% if driver.status != 'active' %}
                        <button class="btn btn-success" onclick="updateStatus({{ driver.id_driver }}, 'activate')">Activate</button>
                    {% endif %}
                    {% if driver.status != 'suspended' %}
                        <button class="btn btn-danger" onclick="updateStatus({{ driver.id_driver }}, 'suspend')">Suspend</button>
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <script>
        // Select all checkbox functionality
        document.getElementById('selectAll').addEventListener('change', function() {
            const checkboxes = document.querySelectorAll('.driver-checkbox');
            checkboxes.forEach(checkbox => checkbox.checked = this.checked);
        });

        // Update single driver status
        function updateStatus(driverId, action) {
            fetch(`/api/drivers/${driverId}/${action}/`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': getCookie('csrftoken')
                }
            })
            .then(response => response.json())
            .then(data => {
                alert(`Driver ${action} successful!`);
                location.reload();
            })
            .catch(error => {
                alert('Error: ' + error);
            });
        }

        // Bulk actions
        function bulkAction(action) {
            const selectedDrivers = Array.from(document.querySelectorAll('.driver-checkbox:checked'))
                .map(checkbox => parseInt(checkbox.value));
            
            if (selectedDrivers.length === 0) {
                alert('Please select at least one driver');
                return;
            }

            fetch(`/api/drivers/bulk_${action}/`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': getCookie('csrftoken')
                },
                body: JSON.stringify({
                    driver_ids: selectedDrivers
                })
            })
            .then(response => response.json())
            .then(data => {
                alert(data.message);
                location.reload();
            })
            .catch(error => {
                alert('Error: ' + error);
            });
        }

        // Get CSRF token
        function getCookie(name) {
            let cookieValue = null;
            if (document.cookie && document.cookie !== '') {
                const cookies = document.cookie.split(';');
                for (let i = 0; i < cookies.length; i++) {
                    const cookie = cookies[i].trim();
                    if (cookie.substring(0, name.length + 1) === (name + '=')) {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                    }
                }
            }
            return cookieValue;
        }
    </script>
</body>
</html>